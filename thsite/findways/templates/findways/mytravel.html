{% load static %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="{% static 'findways/style.css' %}">

<div class="container-fluid">
    <div class="row">
        {% if show_result %}
        <div class="col-xs-4 margin-top-10">
            <a href="http://localhost:8000/findways/mytravel">
                <input type="button" class="btn btn-default button-main" value="Do it again !" />
            </a>
        </div>
        <div class="col-xs-offset-4 col-xs-4 margin-top-10">
            <a href="http://localhost:8000/findways/logout">
                <input type="button" class="btn btn-default button-main pull-right" value="Log out" />
            </a>
        </div>
        {% else %}
        <div class="col-xs-offset-8 col-xs-4 margin-top-10">
            <a href="http://localhost:8000/findways/logout">
                <input type="button" class="btn btn-default button-main pull-right" value="Log out" />
            </a>
        </div>
        {% endif %}
    </div>
    {% if show_result %}
    <div class="row">
        <div class="col-xs-12 margin-top-10">
            <h1 class="title">Directions</h1>
            <h2>From : Your current location </br>&emsp;&nbsp;To : {{json2.End_Address}}</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-6">
            {% for way in json2.Routes %}
            <div class="row margin-top-30">
                <div class="col-xs-12">
                    <div class="panel panel-info">
                        <div id="panel-heading" class="panel-heading" onclick="show({{way.id}});">
                            {{way.id}} - {{way.Type}} : {{way.Price}} € - {{way.Total_Duration}} min - {{way.Total_Distance}}</br>
                        </div>
                        <div id= {{way.id}} class="panel-body" style="display:none">
                            <a onclick="return hide({{way.id}});">Hide details</br></a>
                            {% for detail in way.Route_Details %}
                                <b>{{detail.Type}} : {{detail.ElemWay_Duration}} min - {{detail.ElemWay_Distance}}</b></br>
                                {% for step in detail.ElemWay_Steps %}
                                &emsp;&emsp;{{step.instruction}}</br>
                                {% endfor %}
                            {% endfor %}
                        </div>

                        <script>
                                function show(id) {
                                    if(document.getElementById(id).style.display=='none') {
                                        document.getElementById(id).style.display='block';
                                    }
                                    return false;
                                }
                                function hide(id) {
                                    if(document.getElementById(id).style.display=='block') {
                                        document.getElementById(id).style.display='none';
                                    }
                                    return false;
                                }
                        </script>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="col-xs-6 margin-top-30">
                <div class="row">
                    <div class="col-xs-12">
                        Map à insérer ici
                    </div>
                    {% if is_place %}
                    <div class="col-xs-12 margin-top-30">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                Places to visit
                            </div>
                            <div class="panel-body">
                                <ul>
                                    {% for place in json2.Places_to_visit %}
                                        <li>{{place.name}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            <div class="col-xs-6 margin-top-30" id = "map_canvas" >
                <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaPwW26gWCHItZFD7-2rdWtdWimVhc6TU"></script>

                <script>
                    function initialize(json) {


                        var styles = {
                            'monTheme': [
                                {
                                    featureType: 'road',
                                    elementType: 'geometry',
                                    stylers: [{'visibility': 'simplified'}]
                                }, {
                                    featureType: 'road.arterial',
                                    stylers: [
                                        {hue: 149},
                                        {saturation: -78},
                                        {lightness: 0}
                                    ]
                                }, {
                                    featureType: 'road.highway',
                                    stylers: [
                                        {hue: -31},
                                        {saturation: -40},
                                        {lightness: 2.8}
                                    ]
                                }, {
                                    featureType: 'poi',
                                    elementType: 'label',
                                    stylers: [{'visibility': 'off'}]
                                }, {
                                    featureType: 'landscape',
                                    stylers: [
                                        {hue: 163},
                                        {saturation: -26},
                                        {lightness: -1.1}
                                    ]
                                }, {
                                    featureType: 'transit',
                                    stylers: [{'visibility': 'off'}]
                                }, {
                                    featureType: 'water',
                                    stylers: [
                                        {hue: 3},
                                        {saturation: -24.24},
                                        {lightness: -38.57}
                                    ]
                                }
                            ]
                        };
                        var mapOptions = {
                            zoom: 12,
                            center: new google.maps.LatLng(48.861322, 2.340535),
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                        };
                        var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);


                        var arrival_latitude = json['End_Address_Coords']['lat'];
                        var arrival_longitude = json['End_Address_Coords']['lng'];
                        var departure_latitude = json['Start_Address_Coords']['lat'];
                        var departure_longitude = json['Start_Address_Coords']['lng'];

                        console.log(departure_longitude);

                        var departure = new google.maps.LatLng(departure_latitude,departure_longitude);
                        var arrival = new google.maps.LatLng(arrival_latitude,arrival_longitude);

                        var directionsService = new google.maps.DirectionsService();
                        var directionsDisplay = new google.maps.DirectionsRenderer({ 'map': map });
                        var request = {
                            origin : departure,
                            destination: arrival,
                            travelMode : google.maps.DirectionsTravelMode.WALKING,
                            unitSystem: google.maps.DirectionsUnitSystem.METRIC
                        };

                        directionsService.route(request, function(response, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                directionsDisplay.setDirections(response);
                                directionsDisplay.suppressMarkers = true;
                                directionsDisplay.setOptions({polylineOptions:{strokeColor: '#FFD800'}, preserveViewport: true, 'suppressMarkers': true});
                            }
                        });

                        var directionsService2 = new google.maps.DirectionsService();
                        var directionsDisplay2 = new google.maps.DirectionsRenderer({ 'map': map });
                        var request = {
                            origin : departure,
                            destination: arrival,
                            travelMode : google.maps.DirectionsTravelMode.DRIVING,
                            unitSystem: google.maps.DirectionsUnitSystem.METRIC
                        };

                        directionsService2.route(request, function(response, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                directionsDisplay2.setDirections(response);
                                directionsDisplay2.suppressMarkers = true;
                                directionsDisplay2.setOptions({polylineOptions:{strokeColor: '#FF0000'}, preserveViewport: true, 'suppressMarkers': true});
                            }
                        });



                        var directionsService4 = new google.maps.DirectionsService();
                        var directionsDisplay4 = new google.maps.DirectionsRenderer({ 'map': map });
                        var request = {
                            origin : departure,
                            destination: arrival,
                            travelMode : google.maps.DirectionsTravelMode.TRANSIT,
                            unitSystem: google.maps.DirectionsUnitSystem.METRIC
                        };

                        directionsService4.route(request, function(response, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                directionsDisplay4.setDirections(response);
                                directionsDisplay4.setOptions({polylineOptions:{strokeColor: '#B854D8'}, preserveViewport: true, 'suppressMarkers': true});
                            }
                        });






                    }

                    initialize(JSON.parse("{{json2}}"));


                </script>

            </div>

        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col-xs-12 margin-top-10">
            <h1 class="title">Find my way</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-8 border-right">
            <form method="post" action="." class="margin-top-60" id="travel">
                {% csrf_token %}
                <div class="col-xs-offset-1">
                    {{ form.as_p }}
                </div>
                <input type="submit" class="btn btn-default button-main btn-lg col-xs-offset-3 col-xs-6 margin-top-60" value="Find the best itinerary !" />
            </form>
        </div>
        <div class="col-xs-4">
            <div class="panel panel-info">
                <div class="panel-heading">
                    My profile
                </div>
                <div class="panel-body">
                    <ul class="margin-top-30">
                        <li>
                            <div class="col-xs-8">Driving licence</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.licence %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                        <li>
                            <div class="col-xs-8">Credit card</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.card %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                        <li>
                            <div class="col-xs-8">Pass Navigo</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.navigo %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                        <li>
                            <div class="col-xs-8">Pass Vélib</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.velibPass %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                        <li>
                            <div class="col-xs-8">Car</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.car %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                        <li>
                            <div class="col-xs-8">Bike</div>
                            <div class="col-xs-4 blue">
                                {% if user.profile.bike %}
                                    <span class="blue">Yes</span>
                                {% else %}
                                    <span class="blue">No</span>
                                {% endif %}
                            </div>
                        </li>
                    </ul>
                    <a href="{% url 'findways:edit_profile' %}">
                        <input type="button" class="btn btn-default button-main btn-lg col-xs-offset-2 col-xs-8 margin-top-60" value="Change my profile" />
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    </div>
</div>
